[toc]

# SpringMVC

mvc是一种架构模式

模型Model(dao , service)

视图View , (jsp)

控制器Controller(servlet)

## Controller

### 一次视图访问流程

![image-20210323143430692](..\SpringMVC\image-20210323143430692.png)

> 1.分析url
>
> 2.HandlerMapping为处理器映射.DispatcherServler调用,HandlerMapping根据url查找Handler
>
> 3.HandlerExecution表示具体的Handler,主要作用是根据url查找控制器
>
> 4.HandlerExcution将解析后的信息传递给DispatcherServlet
>
> 5.HandlerAdapter表示处理器适配器,按照特定规则去执行Handler
>
> 6.Handler让具体的Controller执行
>
> 7.Controller将执行信息返回给HanlderAdapter.
>
> 8.HandlerAdapter将视图逻辑名或模型传递给DispatcherServlet
>
> 9.DispathcerServlet调用视图解析器(ViewResolver)来解析HandlerAdapter传递逻辑视图名
>
> 10.视图解析器将解析的逻辑视图传递给DispatcharServlet
>
> 11.DispatcherServlet根据视图解析器解析的试图结果,调用具体的视图
>
> 12.最终视图呈现给用户

### springmvc-servlet.xml

```xml
<!--处理器映射器-->
<bean class="org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping"/>
<!--处理器适配器-->
<bean class="org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter"/>
<!--视图解析器-->
<bean class="org.springframework.web.servlet.view.InternalResourceViewResolver" id="internalResourceViewResolver">
        <!--前缀-->
        <property name="prefix" value="/back/"/>
        <!--后缀-->
        <property name="suffix" value=".jsp"/>
    </bean>
```

### 创建控制器

```java
package com.cxy.controller;

import org.springframework.web.servlet.ModelAndView;
import org.springframework.web.servlet.mvc.Controller;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class HelloController implements Controller {
    public ModelAndView handleRequest(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse) throws Exception {
        ModelAndView mv = new ModelAndView();
        //传递
        mv.addObject("res","helloSpringMVC");
        //选择要跳转的视图
        mv.setViewName("eihei");
        return mv;
    }
}

```

### 前端视图

```jsp
<html>
<head>
    <title>Title</title>
</head>
<body>
    ${res}
</body>
</html>
```

### web.xml

```xml
    <!--注册DispatcherServlet-->
    <servlet>
        <servlet-name>springmvc</servlet-name>
        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
        <!--关联配置文件-->
        <init-param>
            <param-name>contextConfigLocation</param-name>
            <param-value>classpath:springmvc-servlet.xml</param-value>
        </init-param>
        <!--启动级别1-->
        <load-on-startup>1</load-on-startup>
    </servlet>
    <!--启动所有请求-->
    <servlet-mapping>
        <servlet-name>springmvc</servlet-name>
        <url-pattern>/</url-pattern>
    </servlet-mapping>
```

## 使用注解开发

### 配置spring-servlet.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        https://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd">

    <context:component-scan base-package="com.cxy.controller"/>
    <mvc:default-servlet-handler/>
    <mvc:annotation-driven/>
    <bean class="org.springframework.web.servlet.view.InternalResourceViewResolver"
          id="internalResourceViewResolver">
        <!--前缀-->
        <property name="prefix" value="/back/"/>
        <!--后缀-->
        <property name="suffix" value=".jsp"/>
    </bean>

</beans>
```

### web.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
         version="4.0">

    <!--注册DispatcherServlet-->
    <servlet>
        <servlet-name>springmvc</servlet-name>
        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
        <!--关联配置文件-->
        <init-param>
            <param-name>contextConfigLocation</param-name>
            <param-value>classpath:springmvc-servlet.xml</param-value>
        </init-param>
        <!--启动级别1-->
        <load-on-startup>1</load-on-startup>
    </servlet>
    <!--启动所有请求-->
    <servlet-mapping>
        <servlet-name>springmvc</servlet-name>
        <url-pattern>/</url-pattern>
    </servlet-mapping>
</web-app>
```

### 编写控制器

```java
package com.cxy.controller;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
public class one {
    @RequestMapping("/h1")
    public String hello(Model model){
        model.addAttribute("res","hello world");
        return "eihei";
    }
}

```

## 转发和重定向

```java
//不配置视图解析器
// - 请求转发
return "forward:/index.jsp"
// - 重定向
return "rediect:/index.jsp"
    
//配置视图解析器
// - 请求转发
return "index"
// - 重定向
return "rediect:/index.jsp"
```

## 数据处理

- 前端传递数据单一

```java
	@GetMapping("/t1")
    public String text1(String name){
        System.out.println(name);
        return "eihei";
    }
```

- 前端传递数据与接收名不相同

```java
    @GetMapping("/t2")
    public String text2(@RequestParam("username") String name){
        System.out.println(name);
        return "eihei";
    }
```

- 传递对象

```java
	@GetMapping("/t3")
    public String text3(User user){
        System.out.println(user);
        return "eihei";
    }
```

