[toc]

> 大数据组个人周报（2023-11-27~2023-12-01）

**【本周主要工作内容】**
  - **价格洞察系统**
    - **二手竞品价-1.4 `已上线`**
      - 工作内容：1、支持屏蔽某个链接。`-100%`。
    - **回收采集-兼容拍机堂数据 `-100% 已测试结束，等待数仓清洗链路完成后上线`**
      - 1、模板解析接口兼容修改 `-100%`
      - 2、任务生成+任务调度+任务重跑+任务诊断整体流程兼容修改 `-100%`
      - 3、联调整体功能正式调用爬虫接口 `-100%`
    - **价格洞察兼容转转精神用户登录。 `-100%`**
      - 工作内容：*与拍机堂需求合并上线。*

**【其他内容】**
  - **云窗http-Server模式播报接口项目开发** `-100%`
    - 提供播报接口，直接写sql完成播报
    - 支持指标播报，阈值告警，负责人@，文件明细播报等播报模式
    - 文档已输出，部分播报已开始使用，目前反馈良好

**【思考】**
**【下周工作内容】**
  - B端价-2.0

> 大数据组个人周报（2023-12-04~2023-12-08）

**【本周主要工作内容】**
  - **价格洞察系统**
    - **回收采集-兼容拍机堂数据 `已上线`**
      - 需求内容：*1、模板解析接口兼容修改 。2、任务生成+任务调度+任务重跑+任务诊断整体流程兼容修改。3、联调整体功能正式调用爬虫接口。*
      - 补充内容：*1、新增标签表ID字段，端外机型ID字段，供数仓回收数据时补充选项使用。2、拍机堂任务量限制。*
    - **价格洞察兼容转转精神用户登录。 `已上线`**
      - 工作内容：*与拍机堂需求合并上线。*
    - **B端价-2.0 `已上线`**
      - 工作内容：*1、B端价配置页属性增加业务线区分。2、B端价列表查询页所有字典列表接口修改数据源。*
    - **二手竞品价-1.5 `联调中 90%`**
      - 工作内容：*1、竞品价列表筛选增加价格区间筛选 `-100%`。2、竞品价增加用户操作日志记录 `-100%`。3、图片增加名称前端分页筛选 `-100%`。*

**【其他内容】**
  - **云窗http-Server模式播报接口**
    - 增加自定义模板播报，定义模板，写sql插空播报。`100%`

**【思考】**
  - 当前需求沟通评审时，暴露了许多的问题，开发文档并没有被各方重视起来，很多开发不明确在多方配合的需求开发下，自己需要负责哪些东西，导致频繁的改动、反复开发。后续应该拉齐各方明确的内容，按照内容进行并行开发，避免测试阶段不暴露问题，上线后作为bug又进行修复。

**【下周工作内容】**
  - 二手竞品价-1.5
  - 数据字典迭代筛选项


> 大数据组个人周报（2023-12-11~2023-12-15）

**【本周主要工作内容】**
  - **价格洞察系统**
    - **二手竞品价-1.5 `已上线`**
      - 工作内容：*1、竞品价列表筛选增加价格区间筛选 `-100%`。2、竞品价增加用户操作日志记录 `-100%`。3、图片增加名称前端分页筛选 `-100%`。*
    - **二手竞品价-1.51 `已提测`**
      - 工作内容：*1、数据字典优化 `-100%`。2、二手价链接爬取功能优化 `-100%`*

**【其他内容】**
  - **云窗http-Server模式播报接口**
    - 增加自定义循环模板播报，增加支持的markdown语法。增加图片播报。`100%`
  - **退货退款4个播报迭代。 `100%`**

**【思考】**

**【下周工作内容】**
- 价格平台新需求


> 大数据组个人周报（2023-12-18~2023-12-22）

**【本周主要工作内容】**
  - **价格洞察系统**
    - **二手竞品价-抖音二手价 `已上线`**
      - 工作内容：*1、抖音二手价前后端接口联调+假数据构造。3、二手价列表页导出功能优化。*
    - **二手竞品价-1.51 `已上线`**
      - 工作内容：*1、数据字典优化 `-100%`。2、二手价链接爬取功能优化 `-100%`*
    - **其他 `已上线`**
      - 1、修复了上线redis内存异常的问题。
      - 2、修复了异步模板添加接口模板为空的情况下的标签解析异常问题。
      - 3、修复了二手价偶尔失败和数据缺失问题。

**【其他内容】**
  - **搭售pop播报迭代。 `10%`**
  - **通过接口信息存hive表通用抽象脚本开发。日志+告警+监控`100%`**

**【思考】**

**【下周工作内容】**
- 价格平台新需求


> 大数据组个人周报（2023-12-25~2023-12-29）

  **【本周主要工作内容】**
  - **价格洞察系统**
    - **线上反馈问题修复 `已上线`**
      - 线上问题：
        - *1、在排查redis内存占用异常的过程中，发现之前redis数据结构设计、使用方面的一些不合理的点，导致一部分的异常情况排查起来没有起到辅助作用。*
        - *2、诊断功能接口响应时间长*
        - *3、采集任务模块的开放接口中，出现少量机型丢失，且异常日志未定位到的问题。*
        - *4、线上任务失败的情况中，出现消息通知丢失，未通知到用户的现象。*
        - *5、JVM GC效率低，对象回收不及时。堆内存占用高*
      - 工作内容：
        - *1、对redis存储的日志和模板信息进行了数据结构的重新选择，按日期+id重新设计查询方式等。`--100%`*
        - *2、优化诊断接口的诊断逻辑，辅助用户判断问题。`--100%`*
        - *3、优化了新增型号模板的接口逻辑，增加了一层异常日志。并且按天将前一天失败的模板告警到企微群。`--100%`*
        - *4、将原先的告警类型从普通消息改为markdown消息，架构侧普通消息仅支持512字节以内的消息。`--100%`*
        - *5、在耗时长、循环久、线程池方法等方法内添加辅助STW的JNI方法，帮助JVM更快的进行回收。从监控上看GC回收速度提升4倍以上。`--100%`*
      - 目前还存在的问题：
        - *告警消息能接收到拍机堂的错误原因反馈为`用户行为异常被限制功能`，但是平台查看和直接查数据库的原因均为看到该错误，而展示为`未知异常`，用户无法判定是否重跑，怀疑是任务回调平台接口时出现了重复回调的情况，已在平台后端加分布式锁处理，暂时先观察，后续协调爬虫侧排查。*

**【其他内容】**
  - **搭售pop播报迭代。 `100%`**
  - **C2B邮寄业务时效播报异常修复，播报逻辑更新。 `100%`**

**【思考】**

**【下周工作内容】**
- 价格平台新需求

> 大数据组个人周报（2024-01-08~2024-01-13）

**【本周主要工作内容】**
  - **价格洞察系统**
    - **二手竞品价-1.52 `已上线`**
      - 内容：1.二手机有效连接按品类自动更新 `-100%`。2.二手价更新频率配置`-100%`。3.二手价更正逻辑调整`-100%`。4.自动调度联调爬虫`-100%`。
      - *目前自动更新调度已上线，但是爬虫反馈调用量过大，可以反馈产品侧是否调整粒度到品牌。*
    - **二手竞品价-1.53 `已提测`**
      - B端价导出接口开发`-100%`
      - 未来24小时内分平台sku任务量小时汇总 `-100%`
      - SKU粒度任务管理（展示、查询、重跑、日志等）`-100%`

**【其他内容】**
  - 云窗Http-server播报项目重构
    - 接口集成在价格洞察项目中，使用洞察的监控等平台基础能力，接口改造和测试100%
    - 数据播报迁移中，老调度问题颇多，目前将绝大多数播报迁移至云窗使用58调度依赖配置


**【思考】**
  - *1、目前sku粒度任务重跑功能开发已完毕，测试环境无法联调爬虫，待上线后验证任务调用逻辑。2、任务小时分布情况可以帮助用户在配置任务时将任务分散开，提高成功率，目前的逻辑针对每日任务有效，但拍机堂属于周粒度任务，后续可以扩充周粒度分布情况。*
  - *58的依赖配置在下游任务为云窗任务时，时间参数的解析存在问题，可能导致小时任务的小时统计批次错误，正在咨询58的相关大佬，看是可以获取上游输入参数等时间参数。*

**【下周工作内容】**

- 价格平台新需求
- 历史播报任务迁移


> 大数据组个人周报（2024-01-15~2024-01-19）

**【本周主要工作内容】**
  - **价格洞察系统**
    - **二手竞品价-1.53 `已上线`**
      - 1、B端价导出接口开发`-100%`。2、未来24小时内分平台sku任务量小时汇总 `-100%`。3、SKU粒度任务管理（展示、查询、重跑、日志等）`-100%`
    - **价格洞察迭代-1.54 `已排期`**
      - 回收价：24小时内sku任务量分状态统计汇总。方便业务判断配置的机型是否有问题需要处理。
      - 二手价：二手价有效链接自动更新迭代，修改给爬虫侧的回调接口，对失效链接将价格置为0。
    

**【其他内容】**  
  - **httpSQL播报接口重构 `已上线`**
    - 接口集成在价格洞察项目中，使用洞察的监控等平台基础能力，接口改造和上线
    - 自身负责的播报已全部从老调度迁移至58数据探查运行，依赖配置流程观察正常，无播报问题。
    - *TODO:文件播报按文件大小分配格式，大于5mb的文件以.tsv格式发送，小于的以.csv格式发送。*

**【思考】**

**【下周工作内容】**
  - 价格洞察迭代-1.54 
  - 播报接口优化

> 大数据组个人周报（2024-01-29~2024-02-02）

**【本周主要工作内容】**
  - **价格洞察系统**
    - **价格洞察迭代 `已上线`**
      - 回收价：24小时内sku任务量分状态统计汇总。方便业务判断配置的机型是否有问题需要处理。
      - 二手价：二手价有效链接自动更新迭代，修改给爬虫侧的回调接口，对失效链接将价格置为0。
      - 导出工具：优化导出为异步分块导出，尝试分sheet多线程导出和分行多线程导出多种。


**【其他内容】**  
  - **httpSQL播报优化 `已上线`**
    - 1.增加新注解定义播报的默认切分大小
    - 2.支持多个查询结果的播报。
    - 3.修复多个播报排序问题
  - **金融借钱播报迭代 `测试中`**
    - 借钱订单量播报口径迭代
    - 借钱放款金额播报口径迭代

**【思考】**

**【下周工作内容】**
  - 接口优化

> 大数据组个人周报（2024-02-19~2024-02-23）

**【本周主要工作内容】**
  - **价格洞察系统**
    - **价格洞察迭代** `方案设计+排期`
      - 历史代码优化 `100%`
      - 失败任务一键批重跑方案设计+表设计`80%`

**【其他内容】**  
  - **httpSQL播报优化 `100%和价格系统下期需求一起上线`**
    - 代码整理，代码优化，无用代码清理。
    - 图片和文件播报标题问题排查修复。

**【思考】**

**【下周工作内容】**

  - 价格洞察-回收价模块新功能排期开发
  - 价格洞察-B端价模块新功能排期开发

> 大数据组个人周报（2024-02-26~2024-03-01）

**【本周主要工作内容】**
  - **价格洞察系统**
    - B端价+回收价更新
      - 1、回收价模块-批量创建任务接口设计开发`-100%`
        - 任务自动分配调度时间方案讨论+SKU任务量上限判断方案讨论
        - 批量创建+任务量周维度汇总+任务量上限接口管理开发
      - 2、回收价模块-数据查看-失败任务汇总开发`-100%`
        - 表结构设计+方案设计
        - 失败任务表开发，同步爬虫和数仓需要的字段信息
      - 3、B端价模块`-100%`
        - 延长窗口期功能开发
        - 窗口期内新增SKU价格数据+抓取配置同步平台配置接口开发
        - 列表新增列 

**【其他内容】**  

**【下周工作内容】**

- B端价+回收价更新 接口联调+测试
- 等待数仓数据测试

> 大数据组个人周报（2024-03-04~2024-03-08）

**【本周主要工作内容】**
- **价格洞察系统**
  - B端价+回收价更新 `已提测`
    - 1、回收价模块-批量创建任务接口设计开发 `-100%`
    - 2、回收价模块-数据查看-失败任务汇总开发 `-100%`
    - 3、B端价模块 `-100%`
    - 4、联调中新增的接口开发 `-100%`

**【其他内容】**  
  - 数据播报-退货退款2个文件明细播报增加字段和站点 `-100%`
  - 数据播报-维修2个文件明细播报增加字段和站点 `-100%`
  - cdc同步tidb的任务异常情况排查 `-100%`

**【下周工作内容】**
  - B端价+回收价上线
  - B端价-取消窗口期
  - 数据字典增加授权和日志 
  - 商品字典相关需求拆分和开发

> 大数据组个人周报（2024-03-11~2024-03-15）

**【本周主要工作内容】**
- **价格洞察系统**
  - B端价+回收价更新 `已上线`
    1. *回收价-批量创建任务、爬取量上限联通任务模块和监控模块。 `-100%`*
    2. *B端价-抓取配置一键代入、列表新增上期价格和评估、窗口期数据补充。 `-100%`*
  - B端价取消窗口期+数据字典迭代 `前端下周二联调`
    1. *相关接口取消窗口期相关的参数。 `-100%`*
    2. *权限管理独立模块接口开发。 `-100%`*
    3. *数据字典权限管控、数据字典日志记录。`-100%`*
  - 新机价重构 `设计中`
    1. *需求整理、表设计、活动流程梳理。`-50%`* 

**【其他内容】**  
  - 对账单明细表cdc同步tidb的任务异常修复。`-100%`

**【下周工作内容】**
  - B端价取消窗口期+数据字典迭代
  - 新机价重构-接口梳理排期开发

> 大数据组个人周报（2024-03-18~2024-03-22）

**【本周主要工作内容】**
- **价格洞察系统**
  - B端价取消窗口期+数据字典迭代 `已上线`
    1. *相关接口取消窗口期相关的参数。*
    2. *权限管理独立模块接口开发。*
    3. *数据字典权限管控、数据字典日志记录。*
  - 新机价系统 `-50%`
    1. *表结构设计、方案流程设计。 `-100%`*
    2. *发售价相关接口设计、开发。 `-100%`*
    3. *新机价SKU+竞品接口设计、开发。 `-90%`*
    4. *新机自动打标功能设计、开发。 `-50%`*
    5. *新机价竞品更新频率配置+自动更新对接爬虫接口 `-0%`* 
    6. *自测 `-30%`*
    7. *联调 `-0%`* 

**【其他内容】**  

**【下周工作内容】**
  - 新机价系统-前后端联调完成进入提测
  - 百亿补贴系统对接http接口评审排期

> 大数据组个人周报（2024-03-25~2024-03-29）

**【本周主要工作内容】**
- **价格洞察系统**
  - 新机价系统 `已提测`
    1. *表结构设计、方案流程设计。 `-100%`*
    2. *发售价相关接口设计、开发。 `-100%`*
    3. *新机价SKU+竞品接口设计、开发。 `-100%`*
    4. *新机自动打标功能设计、开发。 `-100%`*
    5. *新机价竞品更新频率配置+自动更新对接爬虫接口 `-100%`* 
    6. *自测+联调 `-100%`*
  - 人工标签每天自动计算 `接口开发中 -50%`

**【其他内容】**  
  - 企业微信打卡数据接入异常排查和修复 `-100%`

**【下周工作内容】**
  - 新机价系统-上线
  - 人工标签每天自动计算-上线

> 大数据组个人周报（2024-04-07~2024-04-12）

**【本周主要工作内容】**
- **价格洞察系统**
  - 新机价系统 `已上线`
    - *新机价相关模块后端服务已上线。新机价竞品自动更新配置调度更新已上线。调度已联调爬虫跑通。*
  - 人工标签每天自动计算 `已上线`
    - *人工标签计算逻辑每日自动更新，在数仓任务结束后重新计算，并通知到企微告警群和标签日志。*

**【其他内容】**  
  - 售后超时预警群播报 `已上线`
    - *退货退款-物流签收1h后未判责统计+明细。*
    - *维修-物流签收后8h未认领统计+明细。*
    - *维修-物流签收后100h未维修完成统计+明细。*

**【下周工作内容】**
  - 新机价系统-十亿补贴数据接口提供
    - *发售价查询接口开发*
    - *新机价SKU查询接口开发*
    - *新机价标签查询接口开发*
    - *二手价查询接口开发*
    - *数据字典查询接口开发*

> 大数据组个人周报（2024-04-15~2024-04-19）

**【本周主要工作内容】**
- **价格洞察系统**
  - 新机价系统-十亿补贴数据接口提供 `已上线`
    - *发售价查询接口开发*
    - *新机价SKU查询接口开发*
    - *新机价标签查询接口开发*
    - *二手价查询接口开发*
    - *数据字典查询接口开发*
  - 新机价系统对外SCF服务初始化与新机服务SCF接口提供 `初始化完毕，接口待沟通`
    - *发售价查询接口开发 -- 待定*
    - *新机价SKU查询接口开发 -- 待定*

**【其他内容】**  
  - 售后超时预警群播报新增站点迭代 `已提测`
    - *退货退款-物流签收1h后未判责统计+明细。*
    - *维修-物流签收后8h未认领统计+明细。*
    - *维修-物流签收后100h未维修完成统计+明细。*
  - 权限系统用户信息接口修改
    - *以反馈架构部排查接口问题，后续架构将提供新接口，接口文档出后，改造旧脚本。*

**【下周工作内容】**
  - 新机价系统迭代
    - 回收价失败任务增加人工补充价格
    - 对外接口增加标签信息


> 大数据组个人周报（2024-04-22~2024-04-26）

**【本周主要工作内容】**
- **价格洞察系统**
  - 新机价系统对外SCF服务初始化与新机服务SCF接口提供 `-暂停`
    - *发售价查询接口开发 -- 待定*
    - *新机价SKU查询接口开发 -- 待定*
  - 价格洞察周迭代 `已提测`
    - *标签和数据字典编码禁止修改*
    - *基于回收价失败任务记录人工补录+表结构设计+接口开发同步数仓，下游上沙箱后推进*
    - *用户web端配置增改查接口，前端持久化用户配置使用*

**【其他内容】**  
  - 售后超时预警群播报新增站点迭代 `已上线`
    - *退货退款-物流签收1h后未判责统计+明细。*
    - *维修-物流签收后8h未认领统计+明细。*
    - *维修-物流签收后100h未维修完成统计+明细。*
  - 权限系统用户信息接口都中替换
    - *架构提供新接口进行替换，测试数据无误*
  - EHR数据接入——BSID和WXID绑定关系落表
    - *之前柏霖的旧接数任务单次运行时间过长，失败率高，因配合迁移需要，评估后可进行下线处理。*
    - *改造之前的接入任务为增量判断变化用户后再调接口补充，优化单次运行时间从4小时到5分钟。*
    - *增量raw表已对接鑫源，待改造后下线旧接入任务。*

**【下周工作内容】**
  - 价格洞察周迭代
  - 数据提供接口


> 大数据组个人周报（2024-05-06~2024-05-11）

**【本周主要工作内容】**
- **价格洞察系统**
  - 价格系统对外查询SCF服务 `-20%`
    - *价格对外查询逻辑梳理+流程图+口径拉齐 -100%*
    - *价格ES申请、Redis申请 -100%*
    - *项目流程梳理排期 -100%*
    - *查询接口开发 -100%*
    - *价格系统数据同步设计与开发 -5%*
    - *数据同步测试 -0%*
    - *查询接口测试 -20%*
    - *整体流程测试 -0%*
  
  - 价格洞察周迭代 `已上线`
    - *标签和数据字典编码禁止修改*
    - *基于回收价失败任务记录人工补录+表结构设计+接口开发同步数仓*
    - *用户web端配置增改查接口，前端持久化用户配置使用*

**【其他内容】**  

**【下周工作内容】**
  - 价格系统对外查询SCF服务-进入自测阶段
  - 价格系统-站内消息通知模块排期与开发

> 大数据组个人周报（2024-05-13~2024-05-17）
**【本周主要工作内容】**

- **价格洞察系统**
  - 价格系统对外查询SCF服务 `-90%`
    - *价格系统数据同步设计与开发 -100%*
    - *新增批量相关的并发接口 -100%*
    - *数据同步-全量同步+增量同步+测试 -100%*
    - *整体流程测试 -100%*
    - *与卖场后端同学联调（下周介入） -0%*

  - 价格洞察-回收价失败任务高级查询 `-50%`
    - *SKU参数串搜索增加两个维度的模糊搜索 -100%*
    - *自测+联调 0%*

  - 价格洞察-消息通知模块`-50%`
    - *表设计+功能设计 -100%*
    - *跑马灯管理 -50%*
    - *消息管理接口开发 -50%*
    - *自测+联调 0%*

**【其他内容】**  
  - 退货退款超时预警播报-增加武汉等站点。`已上线`
  - 维修播报等播报修改接警人+口径拉齐退货退款。`已上线`

**【下周工作内容】**
  - 价格系统对外查询SCF服务-与卖场后端同学联调
  - 价格洞察-消息通知模块-上线
  - 价格洞察-回收价失败任务高级查询-上线















## 周报末尾

















# 一级标题

## 二级标题

### 三级标题

#### 四级标题

##### 五级标题

###### 六级标题

------

**加粗**

*斜体*

> 引用内容

```sql
代码块
多行
```

`单行代码`

------

- 列表一级
  - 列表二级
  - 列表二级
    - 列表三级
      - 列表四级

- 列表一级

------

| 表头1 | 表头2 | 表头3 |
| ----- | ----- | ----- |
| 11    | 21    | 31    |
| 12    | 22    | 32    |
| 13    | 23    | 33    |



> 在异步任务中添加用来辅助STW的JNI方法后，GC效率明显提升，FullGC数量也明显下降

![image-20231228194322946](image-20231228194322946.png)

![image-20231228194305174](image-20231228194305174.png)





## 需求明确点

### 回收价B端价改版需求

1. 回收价

   1. 统计配置时间-时间不敏感

      1. **疑问**: 时间不敏感中不应该还允许指定明确时间，应仅可以选择**周**或**月**，然后由系统根据某个计算方法会生成运行时间，向之前兼容规划最优分配。

      2. TODO:

         - 明确CRON表达式分配的方法（未明确）

         - 明确任务量预估的计算方法（昨日明确：进行 **属性项** x **质检项** x **机型**或**属性模板数** x **质检模板数**的最大预估）
         - 是否超过账号爬取上线的规则判断（先生成CRON表达式，按生成的CRON表达式计算，计算和当前CRON表达式在同一天的：**账号爬取上限数** - **现存当天任务数** - **该CRON表达式预估任务量**）

   2. 批量创建任务

      - TODO: 
        - 复制时现存BUG未解决，核心痛点未优化，复制功能相当于报废，仅可以带过去机型和平台。
        - 异步创建，每个任务提交后分别loading判断是否创建成功（失败的，如超过上限的，可以重复在当前页面提交，已成功的不提交。该页面为一次性页面，关闭后不可恢复）

   3. 数据查看

      - TODO：

        - 交互方式：爬虫需将失败的请求也进行记录，然后写入kafka，由数仓侧过滤后存入失败sku任务表中
        - 明确平台需要的失败SKU粒度任务的字段

        | 字段名             | 例                                                           | 说明                 |
        | ------------------ | ------------------------------------------------------------ | -------------------- |
        | 执行时间           | 2024-2-21 20:39:41                                           | 前端展示需要         |
        | …                  | 省略字段，如产品需求文档中图片所示                           | 前端展示需要         |
        | 属性串             | {“label”:”存储容量”,”param”:”128G”},{“label”:”购买渠道”,”param”:”大陆国行”}…. | 前端展示需要         |
        | 异常原因           | 由爬虫控制                                                   | 展示或判断使用       |
        | 原始请求参数JSON串 | {"form_data": {"attr": "2744-19922-2,3261-19933-4,3679-34918-2", "wid": "96956", "other_data": {"task_id": "-10001","stat_date": "1999-01-01", "env": "test" }}} | 重跑使用             |
        | 平台               | 1、爱回收，2、拍机堂                                         | 区分参数调用接口使用 |

2. B端价
   1. 延长窗口期（数仓侧逻辑实现待确认）
   2. SKU调整（不存在所谓本期应用和持续应用，持续应用直接去改抓取配置，修改SKU就只影响当期数据）
      1. TODO：以机型粒度弹窗选择SKU项，然后将表格中的现有的该机型数据删掉，后端生成新的该机型数据加入表中，价格置0，类型人工。











